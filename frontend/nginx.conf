# Nginx Yapılandırma Dosyası (Güncellenmiş)

# "events" ve "http" blokları kaldırıldı.
# Sadece server bloğu kalacak.

server {
  listen 80; # 80 numaralı portta dinle

  # React uygulamasının statik dosyalarını sun
  location / {
    root /usr/share/nginx/html; # React build çıktısının olduğu dizin
    index index.html index.htm;
    try_files $uri $uri/ /index.html; # React'in SPA (Single Page Application) routing'i için gerekli
  }

  # Backend API isteklerini yönlendir
  # /api/ ile başlayan tüm istekleri backend servisine yönlendir
  location /api/ {
    proxy_pass http://backend:8000/; # backend: Docker Compose'da tanımlayacağımız backend servisinin adı
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_cache_bypass $http_pragma $http_authorization;
    proxy_no_cache $http_pragma $http_authorization;
    add_header X-Frame-Options "SAMEORIGIN";
  }

  # WebSocket bağlantılarını yönlendir
  # /ws/ ile başlayan tüm WebSocket isteklerini backend servisine yönlendir
  location /ws/ {
    proxy_pass http://backend:8000; # backend: Docker Compose'da tanımlayacağımız backend servisinin adı
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade"; # WebSocket için "Upgrade" başlığı
    proxy_set_header Host $host;
  }
}